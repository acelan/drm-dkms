From 17629c5e9ef75df1120db11de55484fe5b637928 Mon Sep 17 00:00:00 2001
From: Timo Aaltonen <timo.aaltonen@canonical.com>
Date: Mon, 11 Sep 2017 14:06:58 +0300
Subject: [PATCH] Revert "i2c: move locking operations to their own struct"

This reverts commit d1ed7985b9a6b85ea38a330108c51ec83381c01b.
---
 drivers/gpu/drm/drm_dp_helper.c | 10 +++-------
 drivers/i2c/i2c-core.c          | 13 +++++--------
 drivers/i2c/i2c-mux.c           | 25 +++++++++----------------
 include/linux/i2c.h             | 25 +++++++------------------
 4 files changed, 24 insertions(+), 49 deletions(-)

diff --git a/drivers/gpu/drm/drm_dp_helper.c b/drivers/gpu/drm/drm_dp_helper.c
index 3e6fe82..ac3924a 100644
--- a/drivers/gpu/drm/drm_dp_helper.c
+++ b/drivers/gpu/drm/drm_dp_helper.c
@@ -975,12 +975,6 @@ static void unlock_bus(struct i2c_adapter *i2c, unsigned int flags)
 	mutex_unlock(&i2c_to_aux(i2c)->hw_mutex);
 }
 
-static const struct i2c_lock_operations drm_dp_i2c_lock_ops = {
-	.lock_bus = lock_bus,
-	.trylock_bus = trylock_bus,
-	.unlock_bus = unlock_bus,
-};
-
 /**
  * drm_dp_aux_init() - minimally initialise an aux channel
  * @aux: DisplayPort AUX channel
@@ -998,7 +992,9 @@ void drm_dp_aux_init(struct drm_dp_aux *aux)
 	aux->ddc.algo_data = aux;
 	aux->ddc.retries = 3;
 
-	aux->ddc.lock_ops = &drm_dp_i2c_lock_ops;
+	aux->ddc.lock_bus = lock_bus;
+	aux->ddc.trylock_bus = trylock_bus;
+	aux->ddc.unlock_bus = unlock_bus;
 }
 EXPORT_SYMBOL(drm_dp_aux_init);
 
-- 
2.7.4

